name: Format and Fix
on:
  pull_request:
    branches: [main]
jobs:
  fix:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    - run: git fetch origin main && git checkout -b main origin/main && git checkout -
    - uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
    - id: check
      continue-on-error: true
      run: dotnet format --verify-no-changes --include $(git diff --name-only HEAD origin/main | tr '\n' ' ')
    - if: steps.check.outcome == 'failure'
      run: dotnet format --include $(git diff --name-only HEAD origin/main | tr '\n' ' ')
    - if: steps.check.outcome == 'failure'
      run: |
        git config user.name "bot"
        git config user.email "bot@example.com"
        git commit -am "Auto-fix formatting"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
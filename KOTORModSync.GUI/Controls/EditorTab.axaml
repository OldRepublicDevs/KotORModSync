<!--  Copyright 2021-2025 KOTORModSync  -->
<!--  Licensed under the Business Source License 1.1 (BSL 1.1).  -->
<!--  See LICENSE.txt file in the project root for full license information.  -->
<UserControl
    x:Class="KOTORModSync.Controls.EditorTab"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:KOTORModSync.Controls"
    xmlns:converters="clr-namespace:KOTORModSync.Converters"
    xmlns:core="clr-namespace:KOTORModSync.Core;assembly=KOTORModSync.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Name="EditorTabRoot"
    d:DesignHeight="800"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:IndexConverter x:Key="IndexConverter" />
        <converters:ListToVisibilityConverter x:Key="ListToVisibilityConverter" />
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <converters:InvalidUrlVisibilityConverter x:Key="InvalidUrlVisibilityConverter" />
        <converters:CategoryListDisplayConverter x:Key="CategoryListDisplayConverter" />
        <converters:ListToStringConverter x:Key="ListToStringConverter" />
        <converters:ChooseActionVisibility x:Key="ChooseActionVisibility" />
        <converters:NotDestinationActionVisibility x:Key="NotDestinationActionVisibility" />
        <converters:GuidToComponentConverter x:Key="GuidToComponentConverter" />
        <converters:GuidListConverter x:Key="GuidListConverter" />
        <converters:CategoryTooltipConverter x:Key="CategoryTooltipConverter" />
        <converters:TierTooltipConverter x:Key="TierTooltipConverter" />
        <converters:PathResolverConverter x:Key="PathResolverConverter" />
        <converters:InstructionDestinationConverter x:Key="InstructionDestinationConverter" />
        <converters:BooleanAndConverter x:Key="BooleanAndConverter" />
        <converters:FirstSourcePathConverter x:Key="FirstSourcePathConverter" />
        <converters:ChooseActionDisplayConverter x:Key="ChooseActionDisplayConverter" />
        <converters:IsK2GameConverter x:Key="IsK2GameConverter" />
        <converters:ModLinkFilenamesToUrlListConverter x:Key="ModLinkFilenamesToUrlListConverter" />
    </UserControl.Resources>
    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <!--  ReSharper disable once Xaml.BindingWithoutContextNotResolved  -->
        <StackPanel
            x:Name="GuiEditGrid"
            Margin="4"
            DataContext="{Binding CurrentComponent}"
            Spacing="3">

            <!--  Quick Actions Bar  -->
            <Border
                Padding="3"
                HorizontalAlignment="Stretch"
                Classes="summary-card">
                <StackPanel
                    HorizontalAlignment="Right"
                    Orientation="Horizontal"
                    Spacing="6">
                    <TextBlock
                        VerticalAlignment="Center"
                        FontSize="10"
                        Opacity="0.7"
                        Text="Quick Actions:" />
                    <Button
                        x:Name="ExpandAllSectionsButton"
                        Padding="4,2"
                        Click="ExpandAllSections_Click"
                        Content="â–¼ Expand All"
                        FontSize="9" />
                    <Button
                        x:Name="CollapseAllSectionsButton"
                        Padding="4,2"
                        Click="CollapseAllSections_Click"
                        Content="â–² Collapse All"
                        FontSize="9" />
                </StackPanel>
            </Border>

            <!--  Group 1: Basic Information & Description  -->
            <Border Padding="4" Classes="summary-card">
                <StackPanel Spacing="3">
                    <!--  Basic Information Section  -->
                    <Expander
                        x:Name="BasicInfoExpander"
                        Margin="0,0,0,2"
                        HorizontalAlignment="Stretch"
                        Header="ðŸ“¦ Basic Information"
                        IsExpanded="False">
                        <Border
                            Margin="0,2,0,0"
                            Padding="3"
                            Classes="summary-card">
                            <StackPanel Spacing="3">
                                <StackPanel>
                                    <TextBlock Classes="summary-label" Text="Mod Name" />
                                    <TextBox
                                        HorizontalAlignment="Stretch"
                                        Focusable="True"
                                        Text="{Binding Name}"
                                        TextWrapping="Wrap"
                                        Watermark="Enter mod name..." />
                                </StackPanel>

                                <StackPanel>
                                    <TextBlock Classes="summary-label" Text="GUID" />
                                    <TextBox
                                        HorizontalAlignment="Stretch"
                                        FontFamily="Consolas,Courier New,monospace"
                                        FontSize="11"
                                        IsReadOnly="True"
                                        Text="{Binding Guid}"
                                        ToolTip.Tip="Unique identifier for this mod - Do not modify unless you know what you're doing" />
                                </StackPanel>

                                <Grid ColumnDefinitions="*,8,Auto">
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Classes="summary-label" Text="Heading (for documentation)" />
                                        <TextBox
                                            HorizontalAlignment="Stretch"
                                            Focusable="True"
                                            Text="{Binding Heading}"
                                            TextWrapping="Wrap"
                                            Watermark="Optional display heading..." />
                                    </StackPanel>
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Classes="summary-label" Text="Level" />
                                        <NumericUpDown
                                            Width="80"
                                            Maximum="6"
                                            Minimum="1"
                                            Value="1"
                                            ToolTip.Tip="Heading level for documentation (property not yet implemented)" />
                                    </StackPanel>
                                </Grid>

                                <StackPanel>
                                    <TextBlock Classes="summary-label" Text="Author(s)" />
                                    <TextBox
                                        HorizontalAlignment="Stretch"
                                        AcceptsReturn="True"
                                        Focusable="True"
                                        Text="{Binding Author}"
                                        Watermark="Enter author name(s)..." />
                                </StackPanel>

                                <Grid ColumnDefinitions="*,8,*">
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Classes="summary-label" Text="Category" />
                                        <controls:CategorySelectionControl x:Name="CategorySelectionControl" SelectedCategories="{Binding Category, Mode=TwoWay}" />
                                    </StackPanel>

                                    <StackPanel Grid.Column="2">
                                        <TextBlock Classes="summary-label" Text="Tier" />
                                        <ComboBox
                                            HorizontalAlignment="Left"
                                            Focusable="True"
                                            ItemsSource="{Binding $parent[UserControl].TierOptions}"
                                            PlaceholderText="Select tier..."
                                            SelectedItem="{Binding Tier}" />
                                    </StackPanel>
                                </Grid>
                                <StackPanel>
                                    <controls:DownloadLinksControl
                                        HorizontalAlignment="Stretch"
                                        ComponentGuid="{Binding Guid}"
                                        DownloadCacheService="{Binding $parent[Window].DownloadCacheService}"
                                        DownloadLinks="{Binding ResourceRegistry, Mode=OneWay, Converter={StaticResource ModLinkFilenamesToUrlListConverter}}" />
                                </StackPanel>

                                <StackPanel>
                                    <TextBlock Classes="summary-label" Text="Excluded Downloads" />
                                    <TextBlock
                                        Margin="0,0,0,1"
                                        Classes="secondary-text"
                                        FontSize="9"
                                        Text="Filenames to exclude from automatic downloads (one per line)" />
                                    <TextBox
                                        HorizontalAlignment="Stretch"
                                        AcceptsReturn="True"
                                        Focusable="True"
                                        Text="{Binding ExcludedDownloads, Converter={StaticResource ListToStringConverter}}"
                                        TextWrapping="Wrap"
                                        Watermark="optional_file.zip&#x0a;debug_version.7z&#x0a;old_version.rar..." />
                                </StackPanel>

                                <StackPanel>
                                    <TextBlock Classes="summary-label" Text="Installation Method" />
                                    <TextBox
                                        HorizontalAlignment="Stretch"
                                        Focusable="True"
                                        Text="{Binding InstallationMethod}"
                                        Watermark="e.g., TSLPatcher, Manual, HoloPatcher..." />
                                </StackPanel>

                                <StackPanel>
                                    <TextBlock Classes="summary-label" Text="Language Support" />
                                    <TextBlock
                                        Margin="0,0,0,1"
                                        Classes="secondary-text"
                                        FontSize="9"
                                        Text="One language per line" />
                                    <TextBox
                                        HorizontalAlignment="Stretch"
                                        AcceptsReturn="True"
                                        Focusable="True"
                                        Text="{Binding Language, Converter={StaticResource ListToStringConverter}}"
                                        TextWrapping="Wrap"
                                        Watermark="English&#x0a;French&#x0a;German..." />
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <CheckBox
                                        Content="Widescreen Only"
                                        IsChecked="{Binding WidescreenOnly}"
                                        ToolTip.Tip="Check if this mod only works with widescreen patches" />
                                    <CheckBox
                                        Content="Aspyr Exclusive"
                                        IsChecked="{Binding AspyrExclusive}"
                                        IsVisible="{Binding $parent[Window].MainConfigInstance.targetGame, Converter={StaticResource IsK2GameConverter}}"
                                        ToolTip.Tip="Check if this mod only works on Aspyr versions (mobile/console)" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Expander>

                    <!--  Description & Directions Section  -->
                    <Expander
                        x:Name="DescriptionExpander"
                        Margin="0,0,0,2"
                        HorizontalAlignment="Stretch"
                        Header="ðŸ“„ Description &amp; Directions"
                        IsExpanded="False">
                        <Border Margin="0,2,0,0" Padding="2">
                            <StackPanel Spacing="3">
                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,3,2">
                                        <TextBlock Classes="summary-label" Text="Description" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="What this mod does and why users might want it" />
                                        <controls:ExpandableTextBox Text="{Binding Description, Mode=TwoWay}" Watermark="Enter mod description..." />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="3,0,0,2">
                                        <TextBlock Classes="summary-label" Text="Installation Notes" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Special instructions or warnings for users (handled automatically)" />
                                        <controls:ExpandableTextBox Text="{Binding Directions, Mode=TwoWay}" Watermark="Enter any special directions..." />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,3,2">
                                        <TextBlock Classes="summary-label" Text="Description (Spoiler-Free)" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Optional spoiler-free version of description" />
                                        <controls:ExpandableTextBox Text="{Binding DescriptionSpoilerFree, Mode=TwoWay}" Watermark="Optional: enter spoiler-free description..." />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="3,0,0,2">
                                        <TextBlock Classes="summary-label" Text="Installation Notes (Spoiler-Free)" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Optional spoiler-free version of installation notes" />
                                        <controls:ExpandableTextBox Text="{Binding DirectionsSpoilerFree, Mode=TwoWay}" Watermark="Optional: enter spoiler-free directions..." />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,3,2">
                                        <TextBlock Classes="summary-label" Text="Download Instructions" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="How to obtain/download this mod" />
                                        <controls:ExpandableTextBox Text="{Binding DownloadInstructions, Mode=TwoWay}" Watermark="Enter download instructions..." />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="3,0,0,2">
                                        <TextBlock Classes="summary-label" Text="Usage Warning" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Important warnings about using this mod" />
                                        <controls:ExpandableTextBox Text="{Binding UsageWarning, Mode=TwoWay}" Watermark="Enter any warnings..." />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,3,2">
                                        <TextBlock Classes="summary-label" Text="Download Instructions (Spoiler-Free)" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Optional spoiler-free version of download instructions" />
                                        <controls:ExpandableTextBox Text="{Binding DownloadInstructionsSpoilerFree, Mode=TwoWay}" Watermark="Optional: enter spoiler-free download instructions..." />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="3,0,0,2">
                                        <TextBlock Classes="summary-label" Text="Usage Warning (Spoiler-Free)" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Optional spoiler-free version of usage warning" />
                                        <controls:ExpandableTextBox Text="{Binding UsageWarningSpoilerFree, Mode=TwoWay}" Watermark="Optional: enter spoiler-free warning..." />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,3,2">
                                        <TextBlock Classes="summary-label" Text="Screenshots" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="URLs or markdown for screenshots" />
                                        <controls:ExpandableTextBox Text="{Binding Screenshots, Mode=TwoWay}" Watermark="Enter screenshot URLs or markdown..." />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="3,0,0,2">
                                        <TextBlock Classes="summary-label" Text="Screenshots (Spoiler-Free)" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Optional spoiler-free version of screenshots" />
                                        <controls:ExpandableTextBox Text="{Binding ScreenshotsSpoilerFree, Mode=TwoWay}" Watermark="Optional: enter spoiler-free screenshot URLs..." />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,3,2">
                                        <TextBlock Classes="summary-label" Text="Known Bugs" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="List any known issues or bugs with this mod" />
                                        <controls:ExpandableTextBox Text="{Binding KnownBugs, Mode=TwoWay}" Watermark="Enter known bugs or issues..." />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="3,0,0,2">
                                        <TextBlock Classes="summary-label" Text="Installation Warning" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Critical warnings about installation process" />
                                        <controls:ExpandableTextBox Text="{Binding InstallationWarning, Mode=TwoWay}" Watermark="Enter installation warnings..." />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,3,2">
                                        <TextBlock Classes="summary-label" Text="Compatibility Warning" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Warnings about compatibility with other mods or game versions" />
                                        <controls:ExpandableTextBox Text="{Binding CompatibilityWarning, Mode=TwoWay}" Watermark="Enter compatibility warnings..." />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Margin="3,0,0,2">
                                        <TextBlock Classes="summary-label" Text="Steam Notes" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="9"
                                            Text="Special notes for Steam version users" />
                                        <controls:ExpandableTextBox Text="{Binding SteamNotes, Mode=TwoWay}" Watermark="Enter Steam-specific notes..." />
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </Expander>
                </StackPanel>
            </Border>

            <!--  Group 2: Dependencies & Restrictions  -->
            <Border Padding="4" Classes="summary-card">
                <StackPanel Spacing="2">
                    <Expander
                        x:Name="DependenciesExpander"
                        Margin="0,0,0,2"
                        HorizontalAlignment="Stretch"
                        Header="ðŸ”— Dependencies &amp; Restrictions"
                        IsExpanded="False">
                        <Border Margin="0,2,0,0" Padding="2">
                            <Grid ColumnDefinitions="*,*,*,*" RowDefinitions="Auto,Auto">
                                <Border
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    Margin="0,0,2,2"
                                    Padding="3"
                                    BorderThickness="0">
                                    <StackPanel>
                                        <TextBlock
                                            Classes="summary-label"
                                            Text="Dependencies"
                                            ToolTip.Tip="This mod will not be installed if any of these dependencies are NOT SELECTED" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="10"
                                            Text="Mods that must be selected before this one can install" />
                                        <controls:DependencyControl
                                            HorizontalAlignment="Stretch"
                                            CurrentComponent="{Binding Path=CurrentComponent, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            DependencyType="Dependency"
                                            ModManagementService="{Binding Path=ModManagementService, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            ThisGuidList="{Binding Dependencies}" />
                                    </StackPanel>
                                </Border>

                                <Border
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Margin="2,0,2,2"
                                    Padding="3"
                                    BorderThickness="0">
                                    <StackPanel>
                                        <TextBlock
                                            Classes="summary-label"
                                            Text="Restrictions"
                                            ToolTip.Tip="This mod will not be installed if any of these restrictions are SELECTED" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="10"
                                            Text="Incompatible mods that prevent this one from installing" />
                                        <controls:DependencyControl
                                            HorizontalAlignment="Stretch"
                                            CurrentComponent="{Binding Path=CurrentComponent, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            DependencyType="Restriction"
                                            ModManagementService="{Binding Path=ModManagementService, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            ThisGuidList="{Binding Restrictions}" />
                                    </StackPanel>
                                </Border>

                                <Border
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    Margin="2,0,2,2"
                                    Padding="3"
                                    BorderThickness="0">
                                    <StackPanel>
                                        <TextBlock Classes="summary-label" Text="Install Before" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="10"
                                            Text="Mods that should be installed after this one" />
                                        <controls:DependencyControl
                                            HorizontalAlignment="Stretch"
                                            CurrentComponent="{Binding Path=CurrentComponent, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            DependencyType="InstallBefore"
                                            ModManagementService="{Binding Path=ModManagementService, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            ThisGuidList="{Binding InstallBefore}" />
                                    </StackPanel>
                                </Border>

                                <Border
                                    Grid.Row="0"
                                    Grid.Column="3"
                                    Margin="2,0,0,2"
                                    Padding="3"
                                    BorderThickness="0">
                                    <StackPanel>
                                        <TextBlock Classes="summary-label" Text="Install After" />
                                        <TextBlock
                                            Margin="0,0,0,1"
                                            Classes="secondary-text"
                                            FontSize="10"
                                            Text="Mods that should be installed before this one" />
                                        <controls:DependencyControl
                                            HorizontalAlignment="Stretch"
                                            CurrentComponent="{Binding Path=CurrentComponent, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            DependencyType="InstallAfter"
                                            ModManagementService="{Binding Path=ModManagementService, RelativeSource={RelativeSource AncestorType=controls:EditorTab}}"
                                            ThisGuidList="{Binding InstallAfter}" />
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </Border>
                    </Expander>
                </StackPanel>
            </Border>

            <!--  Group 3: Installation Instructions & Optional Components  -->
            <Border Padding="4" Classes="summary-card">
                <StackPanel Spacing="3">
                    <!--  Instructions Section  -->
                    <Expander
                        x:Name="InstructionsExpander"
                        Margin="0,0,0,2"
                        HorizontalAlignment="Stretch"
                        IsExpanded="False">
                        <Expander.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="ðŸ”§ Installation Instructions" />
                                <Button
                                    x:Name="AutoGenerateButton"
                                    Grid.Column="1"
                                    Margin="8,0,0,0"
                                    Click="AutoGenerateInstructions_Click"
                                    Content="ðŸ¤– Auto-Generate"
                                    Tag="{Binding}"
                                    ToolTip.Tip="Automatically generate instructions from mod archive" />
                            </Grid>
                        </Expander.Header>
                        <Border Margin="0,2,0,0" Padding="2">
                            <StackPanel Spacing="3">
                                <TextBlock
                                    Margin="0,0,0,2"
                                    Classes="secondary-text"
                                    FontSize="9"
                                    Text="Define the steps to install this mod" />

                                <ItemsRepeater x:Name="InstructionsRepeater" ItemsSource="{Binding Instructions}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate DataType="core:Instruction">
                                            <controls:InstructionEditorControl
                                                AddNewInstruction="AddNewInstruction_Click"
                                                BrowseDestination="BrowseDestination_Click"
                                                BrowseSourceFiles="BrowseSourceFiles_Click"
                                                BrowseSourceFromFolders="BrowseSourceFromFolders_Click"
                                                DeleteInstruction="DeleteInstruction_Click"
                                                MoveInstructionDown="MoveInstructionDown_Click"
                                                MoveInstructionUp="MoveInstructionUp_Click" />
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>

                                <Button
                                    Margin="0,2,0,0"
                                    HorizontalAlignment="Left"
                                    Click="AddNewInstruction_Click"
                                    Content="âž• Add Instruction"
                                    Tag="{Binding}" />
                            </StackPanel>
                        </Border>
                    </Expander>

                    <!--  Options Section  -->
                    <Expander
                        x:Name="OptionsExpander"
                        Margin="0,0,0,2"
                        HorizontalAlignment="Stretch"
                        Header="âš™ï¸ Optional Components"
                        IsExpanded="False">
                        <Border Margin="0,2,0,0" Padding="2">
                            <StackPanel Spacing="3">
                                <TextBlock
                                    Margin="0,0,0,2"
                                    Classes="secondary-text"
                                    FontSize="9"
                                    Text="Define optional variants or customizations users can choose" />

                                <ItemsRepeater x:Name="OptionsRepeater" ItemsSource="{Binding Options}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate DataType="core:Option">
                                            <controls:OptionEditorControl
                                                AddNewInstruction="AddNewInstruction_Click"
                                                AddNewOption="AddNewOption_Click"
                                                BrowseDestination="BrowseDestination_Click"
                                                BrowseSourceFiles="BrowseSourceFiles_Click"
                                                BrowseSourceFromFolders="BrowseSourceFromFolders_Click"
                                                DeleteInstruction="DeleteInstruction_Click"
                                                DeleteOption="DeleteOption_Click"
                                                MoveInstructionDown="MoveInstructionDown_Click"
                                                MoveInstructionUp="MoveInstructionUp_Click"
                                                MoveOptionDown="MoveOptionDown_Click"
                                                MoveOptionUp="MoveOptionUp_Click" />
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>

                                <Button
                                    Margin="0,2,0,0"
                                    HorizontalAlignment="Left"
                                    Click="AddNewOption_Click"
                                    Content="âž• Add Option"
                                    Tag="{Binding}"
                                    ToolTip.Tip="Add optional components users can choose during installation" />
                            </StackPanel>
                        </Border>
                    </Expander>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>

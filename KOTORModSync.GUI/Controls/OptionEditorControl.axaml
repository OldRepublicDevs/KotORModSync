<!-- Copyright 2021-2025 KOTORModSync -->
<!-- Licensed under the Business Source License 1.1 (BSL 1.1). -->
<!-- See LICENSE.txt file in the project root for full license information. -->
<UserControl
    x:Class="KOTORModSync.Controls.OptionEditorControl"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:KOTORModSync.Controls"
    xmlns:converters="clr-namespace:KOTORModSync.Converters"
    xmlns:core="clr-namespace:KOTORModSync.Core;assembly=KOTORModSync.Core">
    <UserControl.Resources>
        <converters:IndexConverter x:Key="IndexConverter" />
    </UserControl.Resources>

    <Border
        Margin="0,4,0,0"
        Padding="6"
        Classes="summary-option-card">
        <Expander HorizontalAlignment="Stretch" IsExpanded="False">
            <Expander.Header>
                <Grid HorizontalAlignment="Stretch" ColumnDefinitions="Auto,*,Auto">
                    <Border
                        Grid.Column="0"
                        Margin="0,0,8,0"
                        Padding="6,2"
                        Classes="mod-list-item-badge"
                        CornerRadius="4">
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="11"
                            FontWeight="Bold">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource IndexConverter}">
                                    <MultiBinding.Bindings>
                                        <Binding Path="$parent[ItemsRepeater].Options" />
                                        <Binding Path="." />
                                    </MultiBinding.Bindings>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </Border>

                    <StackPanel
                        Grid.Column="1"
                        VerticalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="8">
                        <TextBlock FontWeight="SemiBold" Text="{Binding Name}" />
                        <TextBlock Opacity="0.5" Text="-" />
                        <TextBlock
                            MaxWidth="300"
                            Opacity="0.7"
                            Text="{Binding Description}"
                            TextTrimming="CharacterEllipsis" />
                    </StackPanel>

                    <StackPanel
                        Grid.Column="2"
                        Orientation="Horizontal"
                        Spacing="2">
                        <controls:ActionButtonsControl
                            DeleteItem="DeleteOption_Click"
                            MoveItemDown="MoveOptionDown_Click"
                            MoveItemUp="MoveOptionUp_Click" />
                        <Button
                            Click="AddNewOption_Click"
                            Content="âž• Insert"
                            Tag="{Binding}"
                            ToolTip.Tip="Insert new option here" />
                    </StackPanel>
                </Grid>
            </Expander.Header>

            <StackPanel Margin="0,8,0,0" Spacing="6">
                <!--  Option Name  -->
                <StackPanel Spacing="2">
                    <TextBlock Classes="summary-label" Text="Option Name" />
                    <TextBlock Classes="secondary-text" FontSize="10">
                        <Run Text="User-facing name for this installation option" />
                    </TextBlock>
                    <TextBox
                        Focusable="True"
                        Text="{Binding Name}"
                        Watermark="e.g., High Resolution Textures" />
                </StackPanel>

                <!--  Description  -->
                <StackPanel Spacing="2">
                    <TextBlock Classes="summary-label" Text="Description" />
                    <TextBlock Classes="secondary-text" FontSize="10">
                        <Run Text="Explain what this option does and when to use it" />
                    </TextBlock>
                    <TextBox
                        MinHeight="40"
                        AcceptsReturn="True"
                        Focusable="True"
                        Text="{Binding Description}"
                        TextWrapping="Wrap"
                        Watermark="Describe this option..." />
                </StackPanel>

                <Separator Classes="summary-separator" />

                <!--  Dependencies & Restrictions  -->
                <Expander Header="ðŸ”— Dependencies &amp; Restrictions" IsExpanded="False" HorizontalAlignment="Stretch">
                    <StackPanel Margin="0,4,0,0" Spacing="6">
                        <StackPanel Spacing="2">
                            <TextBlock
                                Classes="summary-label"
                                Text="Dependencies"
                                ToolTip.Tip="This option will NOT install if ANY of these are NOT selected" />
                            <TextBlock
                                Classes="secondary-text"
                                FontSize="10"
                                TextWrapping="Wrap">
                                <Run Text="Other mods/options that must be selected for this to work" />
                            </TextBlock>
                            <controls:DependencyControl ThisGuidList="{Binding Dependencies}" />
                        </StackPanel>

                        <StackPanel Spacing="2">
                            <TextBlock
                                Classes="summary-label"
                                Text="Restrictions"
                                ToolTip.Tip="This option will NOT install if ANY of these are selected" />
                            <TextBlock
                                Classes="secondary-text"
                                FontSize="10"
                                TextWrapping="Wrap">
                                <Run Text="Incompatible mods/options that prevent this from installing" />
                            </TextBlock>
                            <controls:DependencyControl ThisGuidList="{Binding Restrictions}" />
                        </StackPanel>
                    </StackPanel>
                </Expander>

                <!--  Instructions  -->
                <Expander Header="ðŸ”§ Installation Instructions" IsExpanded="True" HorizontalAlignment="Stretch">
                    <StackPanel Margin="0,4,0,0" Spacing="6">
                        <TextBlock
                            Classes="secondary-text"
                            FontSize="10"
                            TextWrapping="Wrap">
                            <Run Text="Define the steps to install this option" />
                        </TextBlock>

                        <ItemsRepeater x:Name="OptionInstructionsRepeater" ItemsSource="{Binding Instructions}">
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate DataType="core:Instruction">
                                    <controls:InstructionEditorControl
                                        AddNewInstruction="AddNewInstruction_Click"
                                        BrowseDestination="BrowseDestination_Click"
                                        BrowseModFiles="BrowseModFiles_Click"
                                        BrowseSourceFiles="BrowseSourceFiles_Click"
                                        DeleteInstruction="DeleteInstruction_Click"
                                        MoveInstructionDown="MoveInstructionDown_Click"
                                        MoveInstructionUp="MoveInstructionUp_Click" />
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>

                        <Button
                            Margin="0,4,0,0"
                            HorizontalAlignment="Left"
                            Click="AddNewInstruction_Click"
                            Content="âž• Add Instruction"
                            Tag="{Binding}" />
                    </StackPanel>
                </Expander>
            </StackPanel>
        </Expander>
    </Border>
</UserControl>

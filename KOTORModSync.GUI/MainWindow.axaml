<!--  Copyright 2021-2025 KOTORModSync  -->
<!--  Licensed under the Business Source License 1.1 (BSL 1.1).  -->
<!--  See LICENSE.txt file in the project root for full license information.  -->
<Window
    x:Class="KOTORModSync.MainWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:KOTORModSync.Controls"
    xmlns:converters="clr-namespace:KOTORModSync.Converters"
    xmlns:core="clr-namespace:KOTORModSync.Core;assembly=KOTORModSync.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    x:Name="RootWindow"
    Title="KOTORModSync"
    Width="1280"
    Height="720"
    MinWidth="600"
    MinHeight="400"
    d:DesignHeight="720"
    d:DesignWidth="1280"
    DragDrop.AllowDrop="True"
    ExtendClientAreaChromeHints="NoChrome"
    ExtendClientAreaTitleBarHeightHint="-1"
    ExtendClientAreaToDecorationsHint="True"
    SystemDecorations="BorderOnly"
    mc:Ignorable="d">

    <Window.Resources>
        <converters:IndexConverter x:Key="IndexConverter" />
        <converters:ListToVisibilityConverter x:Key="ListToVisibilityConverter" />
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <converters:InvalidUrlVisibilityConverter x:Key="InvalidUrlVisibilityConverter" />
        <converters:CategoryListDisplayConverter x:Key="CategoryListDisplayConverter" />
        <converters:ListToStringConverter x:Key="ListToStringConverter" />
        <converters:ChooseActionVisibility x:Key="ChooseActionVisibility" />
        <converters:NotDestinationActionVisibility x:Key="NotDestinationActionVisibility" />
        <converters:GuidToComponentConverter x:Key="GuidToComponentConverter" />
        <converters:GuidListConverter x:Key="GuidListConverter" />
        <converters:CategoryTooltipConverter x:Key="CategoryTooltipConverter" />
        <converters:TierTooltipConverter x:Key="TierTooltipConverter" />
        <converters:PathResolverConverter x:Key="PathResolverConverter" />
        <converters:InstructionDestinationConverter x:Key="InstructionDestinationConverter" />
        <converters:BooleanAndConverter x:Key="BooleanAndConverter" />
        <converters:FirstSourcePathConverter x:Key="FirstSourcePathConverter" />
        <converters:ChooseActionDisplayConverter x:Key="ChooseActionDisplayConverter" />
    </Window.Resources>

    <Window.Styles />

    <Panel>

        <Grid
            x:Name="MainGrid"
            MinWidth="200"
            RowDefinitions="Auto,Auto,*">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="250" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!--  Header row: menu (left), centered title (middle), window controls (right)  -->
            <Grid
                Grid.Row="0"
                Grid.Column="0"
                Grid.ColumnSpan="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Menu x:Name="TopMenu" Grid.Column="0" />
                <TextBlock
                    x:Name="TitleTextBlock"
                    Grid.Column="1"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="24"
                    FontWeight="Bold"
                    Text="KOTORModSync" />
                <StackPanel
                    Grid.Column="2"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Orientation="Horizontal"
                    Spacing="0">
                    <Button
                        Width="40"
                        Height="40"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Click="MinimizeButton_Click"
                        Content="-"
                        FontSize="15" />
                    <Button
                        Width="40"
                        Height="40"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Click="ToggleMaximizeButton_Click"
                        Content="â–¢"
                        FontSize="15" />
                    <Button
                        Width="40"
                        Height="40"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Click="CloseButton_Click"
                        Content="X"
                        FontSize="15" />
                </StackPanel>
            </Grid>
            <!--  Getting Started button row  -->
            <Grid
                Grid.Row="1"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                RowDefinitions="Auto,Auto">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel
                    Grid.Row="0"
                    Grid.RowSpan="2"
                    Grid.Column="0"
                    Margin="10,4,10,4"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
                    <ToggleSwitch
                        x:Name="EditorModeToggle"
                        Margin="0,0,20,0"
                        VerticalAlignment="Center"
                        Content="Editor Mode"
                        IsChecked="{Binding EditorMode, Mode=TwoWay}"
                        ToolTip.Tip="Toggle to enable Editor Mode: exposes Raw/Editor tabs, editing buttons, and creation tools. When off, the UI is simplified for end users installing mods." />
                    <ToggleSwitch
                        x:Name="SpoilerFreeModeToggle"
                        Margin="0,0,20,0"
                        VerticalAlignment="Center"
                        Content="Spoiler-Free Mode"
                        IsChecked="{Binding SpoilerFreeMode, Mode=TwoWay}"
                        IsVisible="False"
                        ToolTip.Tip="Toggle to enable Spoiler-Free Mode: hides spoiler content in descriptions, directions, and other text fields to avoid plot reveals." />
                </StackPanel>
                <Button
                    x:Name="HomeButton"
                    Grid.Row="0"
                    Grid.RowSpan="2"
                    Grid.Column="1"
                    MinWidth="300"
                    Margin="10,4,10,4"
                    Padding="24,12"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    Click="HomeButton_Click"
                    Content="ðŸ  Home"
                    FontSize="18"
                    ToolTip.Tip="Return to the getting started guide" />
                <StackPanel
                    Grid.Column="2"
                    Margin="0,4,10,4"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Orientation="Vertical"
                    Spacing="4">
                    <Button
                        x:Name="OutputWindowButton"
                        HorizontalAlignment="Stretch"
                        Click="OpenOutputWindow_Click"
                        Content="ðŸ“Š Output Window"
                        ToolTip.Tip="Open the output window to view detailed logs" />
                    <Button
                        x:Name="HeaderSettingsButton"
                        HorizontalAlignment="Stretch"
                        Click="OpenSettings_Click"
                        Content="âš™ï¸ Settings"
                        ToolTip.Tip="Open settings dialog to configure preferences" />
                </StackPanel>
            </Grid>

            <!--  Mod List Sidebar  -->
            <controls:ModListSidebar
                x:Name="ModListSidebar"
                Grid.Row="2"
                Grid.Column="0"
                AddNewModRequested="AddNewMod_Click"
                ApplyCategorySelectionsRequested="ApplyCategorySelections_Click"
                AutofetchInstructionsRequested="AutoGenerateAllComponents_Click"
                ClearCategorySelectionRequested="ClearCategorySelection_Click"
                CloseTOMLRequested="CloseTOMLFile_Click"
                DeselectAllRequested="DeselectAll_Click"
                LockInstallOrderRequested="AutoGenerateDependencies_Click"
                ModManagementToolsRequested="ShowModManagementDialog"
                ModStatisticsRequested="ShowModStatistics_Click"
                RefreshListRequested="RefreshComponents_Click"
                RemoveAllDependenciesRequested="RemoveAllDependencies_Click"
                SaveConfigRequested="SaveModFileAs_Click"
                SearchText="{Binding SearchText, Mode=TwoWay}"
                SelectAllRequested="SelectAll_Click"
                SelectByTierRequested="SelectByTier_Click"
                ValidateAllModsRequested="ValidateAllMods_Click" />
            <GridSplitter
                Grid.Row="2"
                Grid.Column="0"
                HorizontalAlignment="Right" />
            <TabControl
                x:Name="TabControl"
                Grid.Row="2"
                Grid.Column="1"
                HorizontalAlignment="Stretch"
                SelectionChanged="TabControl_SelectionChanged">
                <TabItem
                    x:Name="InitialTab"
                    Header="Getting Started"
                    IsVisible="False">
                    <TabItem.Content>
                        <controls:GettingStartedTab
                            x:Name="GettingStartedTabControl"
                            AutoFixRequested="GettingStartedTab_AutoFixRequested"
                            CreateGithubIssueRequested="GettingStartedTab_CreateGithubIssueRequested"
                            DirectoryChangedRequested="GettingStartedTab_DirectoryChangedRequested"
                            DownloadStatusRequested="GettingStartedTab_DownloadStatusRequested"
                            InstallRequested="GettingStartedTab_InstallRequested"
                            JumpToCurrentStepRequested="GettingStartedTab_JumpToCurrentStepRequested"
                            JumpToModRequested="GettingStartedTab_JumpToModRequested"
                            LoadInstructionFileRequested="GettingStartedTab_LoadInstructionFileRequested"
                            NextErrorRequested="GettingStartedTab_NextErrorRequested"
                            OpenModDirectoryRequested="GettingStartedTab_OpenModDirectoryRequested"
                            OpenOutputWindowRequested="GettingStartedTab_OpenOutputWindowRequested"
                            OpenSettingsRequested="GettingStartedTab_OpenSettingsRequested"
                            OpenSponsorPageRequested="GettingStartedTab_OpenSponsorPageRequested"
                            PrevErrorRequested="GettingStartedTab_PrevErrorRequested"
                            ScrapeDownloadsRequested="GettingStartedTab_ScrapeDownloadsRequested"
                            StopDownloadsRequested="GettingStartedTab_StopDownloadsRequested"
                            ValidateRequested="GettingStartedTab_ValidateRequested" />
                    </TabItem.Content>
                </TabItem>
                <TabItem
                    x:Name="SummaryTabItem"
                    Header="Summary"
                    IsVisible="{Binding EditorMode}">
                    <TabItem.Content>
                        <controls:SummaryTab
                            x:Name="SummaryTabControl"
                            CheckBoxChangedRequested="SummaryTab_CheckBoxChangedRequested"
                            CopyTextToClipboardRequested="SummaryTab_CopyTextToClipboardRequested"
                            CurrentComponent="{Binding CurrentComponent}"
                            EditorMode="{Binding EditorMode}"
                            JumpToInstructionRequested="SummaryTab_JumpToInstructionRequested"
                            OpenLinkRequested="SummaryTab_OpenLinkRequested"
                            SpoilerFreeMode="{Binding SpoilerFreeMode}"
                            SummaryOptionPointerPressedRequested="SummaryTab_SummaryOptionPointerPressedRequested" />
                    </TabItem.Content>
                </TabItem>

                <TabItem
                    x:Name="GuiEditTabItem"
                    Header="Editor"
                    IsVisible="{Binding EditorMode}">
                    <TabItem.Content>
                        <controls:EditorTab
                            x:Name="EditorTabControl"
                            AddNewInstructionRequested="EditorTab_AddNewInstructionRequested"
                            AddNewOptionRequested="EditorTab_AddNewOptionRequested"
                            AutoGenerateInstructionsRequested="EditorTab_AutoGenerateInstructionsRequested"
                            BrowseDestinationRequested="EditorTab_BrowseDestinationRequested"
                            BrowseSourceFilesRequested="EditorTab_BrowseSourceFilesRequested"
                            BrowseSourceFromFoldersRequested="EditorTab_BrowseSourceFromFoldersRequested"
                            CollapseAllSectionsRequested="EditorTab_CollapseAllSectionsRequested"
                            CurrentComponent="{Binding CurrentComponent}"
                            DeleteInstructionRequested="EditorTab_DeleteInstructionRequested"
                            DeleteOptionRequested="EditorTab_DeleteOptionRequested"
                            DownloadCacheService="{Binding DownloadCacheService}"
                            ExpandAllSectionsRequested="EditorTab_ExpandAllSectionsRequested"
                            JumpToBlockingInstructionRequested="EditorTab_JumpToBlockingInstructionRequested"
                            ModManagementService="{Binding ModManagementService}"
                            MoveInstructionDownRequested="EditorTab_MoveInstructionDownRequested"
                            MoveInstructionUpRequested="EditorTab_MoveInstructionUpRequested"
                            MoveOptionDownRequested="EditorTab_MoveOptionDownRequested"
                            MoveOptionUpRequested="EditorTab_MoveOptionUpRequested"
                            TierOptions="{Binding TierOptions}" />
                    </TabItem.Content>
                </TabItem>
                <TabItem
                    x:Name="RawEditTabItem"
                    Header="Raw"
                    IsVisible="{Binding EditorMode}"
                    ToolTip.Tip="Click 'Apply Editor Changes' to save raw changes">
                    <TabItem.Content>
                        <controls:RawTab
                            x:Name="RawTabControl"
                            ApplyEditorChangesRequested="RawTab_ApplyEditorChangesRequested"
                            CurrentComponent="{Binding CurrentComponent}"
                            GenerateGuidRequested="RawTab_GenerateGuidRequested" />
                    </TabItem.Content>
                </TabItem>
            </TabControl>
            <!--<ContentControl
        Grid.Row="4" Content="{Binding LogViewer}" />-->
        </Grid>

        <!--  Drag & Drop Overlay  -->
        <Border
            x:Name="DragDropOverlay"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Background="#E0000000"
            IsVisible="False"
            Opacity="0.9">
            <Grid
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                RowDefinitions="Auto,Auto,Auto,Auto">
                <Border
                    Grid.Row="0"
                    MinWidth="400"
                    MaxWidth="600"
                    Padding="32,24"
                    Background="#F0F0F0"
                    BorderBrush="#CCCCCC"
                    BorderThickness="2"
                    CornerRadius="12">
                    <StackPanel Spacing="16">
                        <TextBlock
                            x:Name="DragDropTitle"
                            HorizontalAlignment="Center"
                            FontSize="24"
                            FontWeight="Bold"
                            Text="Drop File Here" />
                        <TextBlock
                            x:Name="DragDropFileName"
                            HorizontalAlignment="Center"
                            FontSize="18"
                            Text="No file detected"
                            TextAlignment="Center"
                            TextWrapping="Wrap" />
                        <TextBlock
                            x:Name="DragDropFileInfo"
                            HorizontalAlignment="Center"
                            FontSize="14"
                            Foreground="#666666"
                            Text="File information will appear here"
                            TextAlignment="Center"
                            TextWrapping="Wrap" />
                        <Border
                            x:Name="DragDropActionBorder"
                            Margin="0,8,0,0"
                            Padding="16,12"
                            Background="#E8F4FD"
                            BorderBrush="#2196F3"
                            BorderThickness="2"
                            CornerRadius="8">
                            <TextBlock
                                x:Name="DragDropActionText"
                                HorizontalAlignment="Center"
                                FontSize="16"
                                Text="What will happen when you drop this file?"
                                TextAlignment="Center"
                                TextWrapping="Wrap" />
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!--  Loading Overlay  -->
        <Border
            x:Name="LoadingOverlay"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Background="#E0000000"
            IsVisible="False"
            Opacity="0.9">
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border
                    MinWidth="300"
                    Padding="48,32"
                    Background="#F0F0F0"
                    BorderBrush="#CCCCCC"
                    BorderThickness="2"
                    CornerRadius="12">
                    <StackPanel HorizontalAlignment="Center" Spacing="24">
                        <ProgressBar
                            x:Name="LoadingSpinner"
                            Width="60"
                            Height="60"
                            HorizontalAlignment="Center"
                            IsIndeterminate="True" />
                        <TextBlock
                            x:Name="LoadingText"
                            HorizontalAlignment="Center"
                            FontSize="18"
                            FontWeight="SemiBold"
                            Text="Loading file..."
                            TextAlignment="Center" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Panel>
</Window>

<!-- Copyright 2021-2025 KOTORModSync -->
<!-- Licensed under the Business Source License 1.1 (BSL 1.1). -->
<!-- See LICENSE.txt file in the project root for full license information. -->
<Window
    x:Class="KOTORModSync.OutputWindow"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Log Viewer"
    Width="1000"
    Height="600"
    MinWidth="600"
    MinHeight="400"
    d:DesignHeight="600"
    d:DesignWidth="1000"
    ExtendClientAreaChromeHints="NoChrome"
    ExtendClientAreaTitleBarHeightHint="-1"
    ExtendClientAreaToDecorationsHint="True"
    SystemDecorations="BorderOnly"
    mc:Ignorable="d">
    <Panel>
        <!--  Custom Window Controls  -->
        <StackPanel
            Margin="0,8,8,0"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Orientation="Horizontal"
            Spacing="0">
            <Button
                Width="40"
                Height="40"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Click="MinimizeButton_Click"
                Content="-"
                FontSize="16" />
            <Button
                Width="40"
                Height="40"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Click="ToggleMaximizeButton_Click"
                Content="â–¢"
                FontSize="16" />
            <Button
                Width="40"
                Height="40"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Click="CloseButton_Click"
                Content="X"
                FontSize="16" />
        </StackPanel>

        <Border
            Margin="20"
            Padding="0"
            CornerRadius="12">
            <Grid RowDefinitions="Auto,Auto,*">
                <!--  Header  -->
                <Border
                    Grid.Row="0"
                    Padding="12,10"
                    CornerRadius="12,12,0,0">
                    <DockPanel LastChildFill="True">
                        <StackPanel
                            VerticalAlignment="Center"
                            DockPanel.Dock="Left"
                            Orientation="Horizontal"
                            Spacing="12">
                            <Border
                                Width="32"
                                Height="32"
                                VerticalAlignment="Center"
                                CornerRadius="16">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Text="ðŸ“‹" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="20"
                                    FontWeight="Bold"
                                    Text="Log Viewer" />
                                <TextBlock FontSize="12" Text="Real-time application logs and diagnostics" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel
                            VerticalAlignment="Center"
                            DockPanel.Dock="Right"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Button
                                MinWidth="80"
                                Padding="10,4"
                                Click="ClearLog_Click"
                                Content="ðŸ—‘ï¸ Clear"
                                CornerRadius="6" />
                            <Button
                                MinWidth="80"
                                Padding="10,4"
                                Click="SaveLog_Click"
                                Content="ðŸ’¾ Save"
                                CornerRadius="6" />
                        </StackPanel>
                    </DockPanel>
                </Border>

                <!--  Status bar  -->
                <Border Grid.Row="1" Padding="12,6">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Orientation="Horizontal"
                            Spacing="16">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="12"
                                    Text="ðŸ“Š" />
                                <TextBlock FontWeight="Bold" Text="Lines:" />
                                <TextBlock
                                    x:Name="LineCountText"
                                    FontWeight="Bold"
                                    Text="0" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock
                                    VerticalAlignment="Center"
                                    FontSize="12"
                                    Text="âš¡" />
                                <TextBlock FontWeight="Bold" Text="Auto-scroll:" />
                                <CheckBox
                                    x:Name="AutoScrollCheckBox"
                                    VerticalAlignment="Center"
                                    IsChecked="True" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel
                            Grid.Column="1"
                            VerticalAlignment="Center"
                            Orientation="Horizontal"
                            Spacing="8">
                            <Border
                                Padding="6,2"
                                Background="{DynamicResource Log.ErrorBadgeBrush}"
                                CornerRadius="3">
                                <TextBlock
                                    FontSize="10"
                                    FontWeight="Bold"
                                    Text="ERROR" />
                            </Border>
                            <Border
                                Padding="6,2"
                                Background="{DynamicResource Log.WarningBadgeBrush}"
                                CornerRadius="3">
                                <TextBlock
                                    FontSize="10"
                                    FontWeight="Bold"
                                    Text="WARN" />
                            </Border>
                            <Border
                                Padding="6,2"
                                Background="{DynamicResource Log.InfoBadgeBrush}"
                                CornerRadius="3">
                                <TextBlock
                                    FontSize="10"
                                    FontWeight="Bold"
                                    Text="INFO" />
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!--  Log content  -->
                <Border
                    Grid.Row="2"
                    Margin="0"
                    CornerRadius="0,0,12,12">
                    <Grid>
                        <ScrollViewer
                            x:Name="LogScrollViewer"
                            Padding="14,10"
                            HorizontalScrollBarVisibility="Auto"
                            VerticalScrollBarVisibility="Auto">
                            <ListBox
                                x:Name="LogListBox"
                                ItemsSource="{Binding LogLines}"
                                KeyDown="LogListBox_KeyDown"
                                SelectionMode="Multiple">
                                <ListBox.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Click="CopySelected_Click" Header="Copy selected" />
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Margin="0,1"
                                            Padding="4,1"
                                            CornerRadius="4"
                                            DataContext="{Binding .}"
                                            Tag="{Binding IsHighlighted}">
                                            <Border.Styles>
                                                <Style Selector="Border[Tag=True]">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource Log.HighlightBorderBrush}" />
                                                    <Setter Property="BorderThickness" Value="2" />
                                                </Style>
                                            </Border.Styles>
                                            <Border
                                                Padding="2"
                                                CornerRadius="3"
                                                Tag="{Binding Level}">
                                                <Border.Styles>
                                                    <Style Selector="Border">
                                                        <Setter Property="Background" Value="Transparent" />
                                                    </Style>
                                                    <Style Selector="Border[Tag=Error]">
                                                        <Setter Property="Background" Value="{DynamicResource Log.ErrorBackgroundBrush}" />
                                                        <Setter Property="BorderBrush" Value="{DynamicResource Log.ErrorBorderBrush}" />
                                                        <Setter Property="BorderThickness" Value="1" />
                                                    </Style>
                                                    <Style Selector="Border[Tag=Warning]">
                                                        <Setter Property="Background" Value="{DynamicResource Log.WarningBackgroundBrush}" />
                                                        <Setter Property="BorderBrush" Value="{DynamicResource Log.WarningBorderBrush}" />
                                                        <Setter Property="BorderThickness" Value="1" />
                                                    </Style>
                                                    <Style Selector="Border[Tag=Info]">
                                                        <Setter Property="Background" Value="{DynamicResource Log.InfoBackgroundBrush}" />
                                                    </Style>
                                                </Border.Styles>
                                                <Grid ColumnDefinitions="Auto,*,Auto">
                                                    <TextBlock
                                                        Grid.Column="0"
                                                        Margin="0,0,8,0"
                                                        VerticalAlignment="Center"
                                                        FontFamily="Consolas,Monaco,monospace"
                                                        FontSize="11"
                                                        Text="{Binding Timestamp}" />
                                                    <SelectableTextBlock
                                                        Grid.Column="1"
                                                        VerticalAlignment="Center"
                                                        FontFamily="Consolas,Monaco,monospace"
                                                        FontSize="12"
                                                        LineHeight="14"
                                                        Text="{Binding Message}"
                                                        TextWrapping="Wrap" />
                                                    <Border
                                                        Grid.Column="2"
                                                        Margin="8,0,0,0"
                                                        Padding="6,2"
                                                        Background="{Binding LevelColor}"
                                                        CornerRadius="3">
                                                        <TextBlock
                                                            FontSize="9"
                                                            FontWeight="Bold"
                                                            Text="{Binding Level}" />
                                                    </Border>
                                                </Grid>
                                            </Border>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </ScrollViewer>

                        <!--  Fallback for simple text display  -->
                        <ScrollViewer
                            x:Name="SimpleLogScrollViewer"
                            Padding="14,10"
                            HorizontalScrollBarVisibility="Auto"
                            IsVisible="False"
                            VerticalScrollBarVisibility="Auto">
                            <SelectableTextBlock
                                x:Name="LogTextBox"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Top"
                                FontFamily="Consolas,Monaco,monospace"
                                FontSize="12"
                                Text="{Binding LogText}"
                                TextWrapping="NoWrap" />
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Panel>
</Window>

<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
        x:Class="KOTORModSync.OutputWindow"
        Title="Log Viewer"
        Width="1000" Height="600"
        MinWidth="600" MinHeight="400"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1"
        SystemDecorations="BorderOnly">
    <Panel>
        <!-- Custom Window Controls -->
        <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Orientation="Horizontal" Spacing="0" Margin="0,8,8,0">
            <Button Content="-" Click="MinimizeButton_Click"
                    HorizontalContentAlignment="Center" VerticalAlignment="Stretch" 
                    HorizontalAlignment="Stretch" Width="40" Height="40" FontSize="16" />
            <Button Content="â–¢" Click="ToggleMaximizeButton_Click"
                    HorizontalContentAlignment="Center" VerticalAlignment="Stretch" 
                    HorizontalAlignment="Stretch" Width="40" Height="40" FontSize="16" />
            <Button Content="X" Click="CloseButton_Click"
                    HorizontalContentAlignment="Center" VerticalAlignment="Stretch" 
                    HorizontalAlignment="Stretch" Width="40" Height="40" FontSize="16" />
        </StackPanel>
        
        <Border Margin="20" Padding="0" CornerRadius="12">
            <Grid RowDefinitions="Auto,Auto,*">
                <!-- Header -->
                <Border Grid.Row="0" CornerRadius="12,12,0,0" Padding="12,10">
                    <DockPanel LastChildFill="True">
                        <StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                            <Border Width="32" Height="32" CornerRadius="16" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ“‹" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Log Viewer" FontSize="20" FontWeight="Bold" />
                                <TextBlock Text="Real-time application logs and diagnostics" FontSize="12" />
                            </StackPanel>
                        </StackPanel>
                        
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                            <Button Content="ðŸ—‘ï¸ Clear" Click="ClearLog_Click"
                                    CornerRadius="6" Padding="10,4" MinWidth="80" />
                            <Button Content="ðŸ’¾ Save" Click="SaveLog_Click"
                                    CornerRadius="6" Padding="10,4" MinWidth="80" />
                        </StackPanel>
                    </DockPanel>
                </Border>

                <!-- Status bar -->
                <Border Grid.Row="1" Padding="12,6">
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock Text="ðŸ“Š" FontSize="12" VerticalAlignment="Center" />
                                <TextBlock Text="Lines:" FontWeight="Bold" />
                                <TextBlock x:Name="LineCountText" Text="0" FontWeight="Bold" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock Text="âš¡" FontSize="12" VerticalAlignment="Center" />
                                <TextBlock Text="Auto-scroll:" FontWeight="Bold" />
                                <CheckBox x:Name="AutoScrollCheckBox" IsChecked="True" VerticalAlignment="Center" />
                            </StackPanel>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                            <Border Background="#FF4444" CornerRadius="3" Padding="6,2">
                                <TextBlock Text="ERROR" FontSize="10" FontWeight="Bold" />
                            </Border>
                            <Border Background="#FFAA00" CornerRadius="3" Padding="6,2">
                                <TextBlock Text="WARN" FontSize="10" FontWeight="Bold" />
                            </Border>
                            <Border Background="#00AA00" CornerRadius="3" Padding="6,2">
                                <TextBlock Text="INFO" FontSize="10" FontWeight="Bold" />
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Log content -->
                <Border Grid.Row="2" CornerRadius="0,0,12,12" Margin="0">
                    <Grid>
                        <ScrollViewer x:Name="LogScrollViewer" 
                                      HorizontalScrollBarVisibility="Auto"
                                      VerticalScrollBarVisibility="Auto"
                                      Padding="14,10">
                            <ListBox x:Name="LogListBox" ItemsSource="{Binding LogLines}" SelectionMode="Multiple" KeyDown="LogListBox_KeyDown">
                                <ListBox.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Copy selected" Click="CopySelected_Click" />
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                                 <ListBox.ItemTemplate>
                                    <DataTemplate>
                                         <Border Margin="0,1" Padding="4,1" CornerRadius="4" Tag="{Binding IsHighlighted}">
                                             <Border.Styles>
                                                 <Style Selector="Border[Tag=True]">
                                                     <Setter Property="BorderBrush" Value="#A8B348" />
                                                     <Setter Property="BorderThickness" Value="2" />
                                                 </Style>
                                             </Border.Styles>
                                             <Border CornerRadius="3" Padding="2" Tag="{Binding Level}">
                                                 <Border.Styles>
                                                     <Style Selector="Border">
                                                         <Setter Property="Background" Value="Transparent" />
                                                     </Style>
                                                     <Style Selector="Border[Tag=Error]">
                                                         <Setter Property="Background" Value="#1AFF4444" />
                                                         <Setter Property="BorderBrush" Value="#FF4444" />
                                                         <Setter Property="BorderThickness" Value="1" />
                                                     </Style>
                                                     <Style Selector="Border[Tag=Warning]">
                                                         <Setter Property="Background" Value="#1AFFAA00" />
                                                         <Setter Property="BorderBrush" Value="#FFAA00" />
                                                         <Setter Property="BorderThickness" Value="1" />
                                                     </Style>
                                                     <Style Selector="Border[Tag=Info]">
                                                         <Setter Property="Background" Value="#1A00AA00" />
                                                     </Style>
                                                 </Border.Styles>
                                                 <Grid ColumnDefinitions="Auto,*,Auto">
                                                     <TextBlock Grid.Column="0" 
                                                                Text="{Binding Timestamp}" 
                                                                FontFamily="Consolas,Monaco,monospace"
                                                                FontSize="11"
                                                                VerticalAlignment="Center"
                                                                Margin="0,0,8,0" />
                                                     <SelectableTextBlock Grid.Column="1" 
                                                                Text="{Binding Message}" 
                                                                FontFamily="Consolas,Monaco,monospace"
                                                                FontSize="12"
                                                                LineHeight="14"
                                                                TextWrapping="Wrap"
                                                                VerticalAlignment="Center" />
                                                     <Border Grid.Column="2" 
                                                             Background="{Binding LevelColor}" 
                                                             CornerRadius="3" 
                                                             Padding="6,2"
                                                             Margin="8,0,0,0">
                                                         <TextBlock Text="{Binding Level}" 
                                                                    FontSize="9" 
                                                                    FontWeight="Bold" 
                                                                    />
                                                     </Border>
                                                 </Grid>
                                             </Border>
                                         </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </ScrollViewer>
                        
                        <!-- Fallback for simple text display -->
                        <ScrollViewer x:Name="SimpleLogScrollViewer" 
                                      HorizontalScrollBarVisibility="Auto"
                                      VerticalScrollBarVisibility="Auto"
                                      Padding="14,10"
                                      IsVisible="False">
                            <SelectableTextBlock x:Name="LogTextBox"
                                                 FontSize="12"
                                                 FontFamily="Consolas,Monaco,monospace"
                                                 HorizontalAlignment="Stretch"
                                                 VerticalAlignment="Top"
                                                 TextWrapping="NoWrap"
                                                 Text="{Binding LogText}" />
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Panel>
</Window>